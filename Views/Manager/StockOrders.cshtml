@model List<GqeberhaPharmacy.Models.StockOrder>

@{
    Layout = "_Layout";
    ViewData["Title"] = "Stock Orders";
}

@section Sidebar {
    <h5 class="mb-4">Manager Menu</h5>
    <a href="/Manager/Index"><i class="fas fa-home"></i> Dashboard</a>
    <a href="/Manager/StockOrders" class="active"><i class="fas fa-shopping-cart"></i> Stock Orders</a>
    <a href="/Manager/LowStockMedications"><i class="fas fa-warning"></i> Low Stock</a>
}

<div class="container">
    <h1><i class="fas fa-shopping-cart"></i> Stock Orders</h1>
    <hr>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Order Number</th>
                    <th>Supplier</th>
                    <th>Order Date</th>
                    <th>Items</th>
                    <th>Status</th>
                    <th>Received Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Count == 0)
                {
                    <tr>
                        <td colspan="7" class="text-center">No stock orders</td>
                    </tr>
                }
                else
                {
                    @foreach (var order in Model)
                    {
                        <tr>
                            <td><strong>@order.OrderNumber</strong></td>
                            <td>@order.Supplier?.Name</td>
                            <td>@order.OrderDate.ToString("dd/MM/yyyy")</td>
                            <td>@order.Items.Count</td>
                            <td>
                                @if (order.Status == 0)
                                {
                                    <span class="badge bg-warning">Pending</span>
                                }
                                else if (order.Status == 1)
                                {
                                    <span class="badge bg-success">Received</span>
                                }
                            </td>
                            <td>
                                @if (order.ReceivedDate.HasValue)
                                {
                                    @order.ReceivedDate.Value.ToString("dd/MM/yyyy")
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewOrder('@order.Id')">View</button>
                                @if (order.Status == 0)
                                {
                                    <button class="btn btn-sm btn-outline-success" onclick="markReceived('@order.Id')">Mark Received</button>
                                }
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function viewOrder(id) {
        alert('View order: ' + id);
    }

    function markReceived(id) {
        if (confirm('Mark this order as received?')) {
            fetch('/Manager/MarkOrderReceived', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ orderId: id })
            })
            .then(r => r.json())
            .then(d => {
                if (d.success) {
                    alert(d.message);
                    location.reload();
                }
            });
        }
    }
</script>
